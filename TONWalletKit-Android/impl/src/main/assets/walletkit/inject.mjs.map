{"version":3,"file":"inject.mjs","sources":["../../walletkit/dist/esm/utils/getDefaultWalletConfig.js","../../walletkit/dist/esm/bridge/core/BridgeConfig.js","../../walletkit/dist/esm/bridge/core/TonConnectBridge.js","../../walletkit/dist/esm/bridge/utils/messageTypes.js","../../walletkit/dist/esm/bridge/utils/timeouts.js","../../walletkit/dist/esm/bridge/transport/ExtensionTransport.js","../../walletkit/dist/esm/bridge/injection/IframeWatcher.js","../../walletkit/dist/esm/bridge/injection/WindowAccessor.js","../../walletkit/dist/esm/bridge/injection/BridgeInjector.js","../../walletkit/dist/esm/bridge/JSBridgeInjector.js","../src/utils/logger.ts","../src/inject.ts"],"sourcesContent":["/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n/**\n * Default device info for JS Bridge\n */\nconst DEFAULT_DEVICE_INFO = {\n    platform: 'browser',\n    appName: 'Wallet',\n    appVersion: '1.0.0',\n    maxProtocolVersion: 2,\n    features: [\n        'SendTransaction',\n        {\n            name: 'SendTransaction',\n            maxMessages: 1,\n        },\n    ],\n};\nconst DEFAULT_WALLET_INFO = {\n    name: 'Wallet',\n    appName: 'Wallet',\n    imageUrl: 'https://example.com/image.png',\n    bridgeUrl: 'https://example.com/bridge.png',\n    universalLink: 'https://example.com/universal-link',\n    aboutUrl: 'https://example.com/about',\n    platforms: ['chrome', 'firefox', 'safari', 'android', 'ios', 'windows', 'macos', 'linux'],\n    jsBridgeKey: 'wallet',\n};\nexport function getDeviceInfoWithDefaults(options) {\n    const deviceInfo = {\n        ...DEFAULT_DEVICE_INFO,\n        ...options,\n    };\n    return deviceInfo;\n}\nexport function createDeviceInfo(options) {\n    const infoWithDefaults = getDeviceInfoWithDefaults(options);\n    const features = [];\n    // send transaction feature\n    if (infoWithDefaults.features.some((feature) => typeof feature === 'object' && feature.name === 'SendTransaction')) {\n        const sendTransactionFeature = infoWithDefaults.features.find((feature) => typeof feature === 'object' && feature.name === 'SendTransaction');\n        if (sendTransactionFeature) {\n            features.push({\n                name: 'SendTransaction',\n                maxMessages: sendTransactionFeature.maxMessages ?? 1,\n            });\n            features.push('SendTransaction');\n        }\n    }\n    else if (infoWithDefaults.features.some((feature) => feature === 'SendTransaction')) {\n        features.push('SendTransaction');\n    }\n    if (infoWithDefaults.features.some((feature) => typeof feature === 'object' && feature.name === 'SignData')) {\n        const signDataFeature = infoWithDefaults.features.find((feature) => typeof feature === 'object' && feature.name === 'SignData');\n        if (signDataFeature) {\n            features.push({\n                name: 'SignData',\n                types: signDataFeature.types,\n            });\n        }\n    }\n    return infoWithDefaults;\n}\nexport function createWalletManifest(options) {\n    const walletInfo = getWalletInfoWithDefaults(options);\n    return walletInfo;\n}\nexport function getWalletInfoWithDefaults(options) {\n    const walletInfo = {\n        ...DEFAULT_WALLET_INFO,\n        ...options,\n    };\n    return walletInfo;\n}\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n/**\n * Validates and normalizes bridge configuration\n */\nexport function validateBridgeConfig(config) {\n    if (!config.deviceInfo) {\n        throw new Error('deviceInfo is required');\n    }\n    if (!config.walletInfo) {\n        throw new Error('walletInfo is required');\n    }\n    if (!config.jsBridgeKey || typeof config.jsBridgeKey !== 'string') {\n        throw new Error('jsBridgeKey must be a non-empty string');\n    }\n    if (config.protocolVersion < 2) {\n        throw new Error('protocolVersion must be at least 2');\n    }\n}\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n/**\n * Core TonConnect JS Bridge implementation\n * Implements the TonConnect protocol specification\n * Uses dependency injection for transport layer\n */\nexport class TonConnectBridge {\n    // Public properties as per TonConnect spec\n    deviceInfo;\n    walletInfo;\n    protocolVersion;\n    isWalletBrowser;\n    // Private state\n    transport;\n    eventListeners = [];\n    constructor(config, transport) {\n        this.deviceInfo = config.deviceInfo;\n        this.walletInfo = config.walletInfo;\n        this.protocolVersion = config.protocolVersion;\n        this.isWalletBrowser = config.isWalletBrowser;\n        this.transport = transport;\n        // Setup event forwarding from transport\n        this.transport.onEvent((event) => {\n            this.notifyListeners(event);\n        });\n    }\n    /**\n     * Initiates connect request - forwards to transport\n     */\n    async connect(protocolVersion, message) {\n        if (protocolVersion < 2) {\n            throw new Error('Unsupported protocol version');\n        }\n        return this.transport.send({\n            method: 'connect',\n            params: { protocolVersion, ...message },\n        });\n    }\n    /**\n     * Attempts to restore previous connection - forwards to transport\n     */\n    async restoreConnection() {\n        return this.transport.send({\n            method: 'restoreConnection',\n            params: [],\n        });\n    }\n    /**\n     * Sends a message to the bridge - forwards to transport\n     */\n    async send(message) {\n        return this.transport.send({\n            method: 'send',\n            params: [message],\n        });\n    }\n    /**\n     * Registers a listener for events from the wallet\n     * Returns unsubscribe function\n     */\n    listen(callback) {\n        if (typeof callback !== 'function') {\n            throw new Error('Callback must be a function');\n        }\n        this.eventListeners.push(callback);\n        // Return unsubscribe function\n        return () => {\n            const index = this.eventListeners.indexOf(callback);\n            if (index > -1) {\n                this.eventListeners.splice(index, 1);\n            }\n        };\n    }\n    /**\n     * Expose listener count for environments that need to fan-out events across frames.\n     */\n    hasListeners() {\n        return this.eventListeners.length > 0;\n    }\n    /**\n     * Notify all registered listeners of an event\n     */\n    notifyListeners(event) {\n        this.eventListeners.forEach((callback) => {\n            try {\n                callback(event);\n            }\n            catch (error) {\n                // eslint-disable-next-line no-console\n                console.error('TonConnect event listener error:', error);\n            }\n        });\n    }\n    /**\n     * Check if transport is available\n     */\n    isTransportAvailable() {\n        return this.transport.isAvailable();\n    }\n    /**\n     * Cleanup resources\n     */\n    destroy() {\n        this.eventListeners.length = 0;\n        this.transport.destroy();\n    }\n}\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n/**\n * Message type constants for JS Bridge communication\n */\n/**\n * Message sent from injected bridge to extension\n */\nexport const TONCONNECT_BRIDGE_REQUEST = 'TONCONNECT_BRIDGE_REQUEST';\n/**\n * Response message from extension to injected bridge\n */\nexport const TONCONNECT_BRIDGE_RESPONSE = 'TONCONNECT_BRIDGE_RESPONSE';\n/**\n * Event message from extension to injected bridge (e.g., disconnect)\n */\nexport const TONCONNECT_BRIDGE_EVENT = 'TONCONNECT_BRIDGE_EVENT';\n/**\n * Message to inject extension ID into page context\n */\nexport const INJECT_EXTENSION_ID = 'INJECT_EXTENSION_ID';\n/**\n * Message to trigger content script injection into iframes\n */\nexport const INJECT_CONTENT_SCRIPT = 'INJECT_CONTENT_SCRIPT';\n/**\n * All message types\n */\nexport const MESSAGE_TYPES = {\n    TONCONNECT_BRIDGE_REQUEST,\n    TONCONNECT_BRIDGE_RESPONSE,\n    TONCONNECT_BRIDGE_EVENT,\n    INJECT_EXTENSION_ID,\n    INJECT_CONTENT_SCRIPT,\n};\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n/**\n * Timeout constants for bridge operations\n */\n/**\n * Default timeout for bridge requests (300 seconds)\n */\nexport const DEFAULT_REQUEST_TIMEOUT = 300000;\n/**\n * Timeout for restoreConnection requests (10 seconds)\n * Shorter because this is called frequently on page load\n */\nexport const RESTORE_CONNECTION_TIMEOUT = 10000;\n/**\n * Supported TonConnect protocol version\n */\nexport const SUPPORTED_PROTOCOL_VERSION = 2;\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport { INJECT_CONTENT_SCRIPT, TONCONNECT_BRIDGE_EVENT, TONCONNECT_BRIDGE_REQUEST, TONCONNECT_BRIDGE_RESPONSE, } from '../utils/messageTypes';\nimport { DEFAULT_REQUEST_TIMEOUT, RESTORE_CONNECTION_TIMEOUT } from '../utils/timeouts';\n/**\n * Chrome extension transport implementation\n * Handles communication between injected bridge and extension background script\n */\nexport class ExtensionTransport {\n    extensionId = null;\n    source;\n    window;\n    pendingRequests = new Map();\n    eventCallback = null;\n    messageListener = null;\n    constructor(window, source) {\n        this.window = window;\n        this.source = source;\n        this.setupMessageListener();\n    }\n    /**\n     * Setup listener for messages from extension\n     */\n    setupMessageListener() {\n        this.messageListener = (event) => {\n            if (event.source !== this.window)\n                return;\n            const data = event.data;\n            if (!data || typeof data !== 'object')\n                return;\n            // Handle extension ID injection\n            if (data.type === 'INJECT_EXTENSION_ID') {\n                this.extensionId = data.extensionId;\n                return;\n            }\n            // Handle bridge responses\n            if (data.type === TONCONNECT_BRIDGE_RESPONSE && data.source === this.source) {\n                this.handleResponse(data);\n                return;\n            }\n            // Handle bridge events\n            if (data.type === TONCONNECT_BRIDGE_EVENT && data.source === this.source) {\n                this.handleEvent(data.event);\n                return;\n            }\n        };\n        this.window.addEventListener('message', this.messageListener);\n    }\n    /**\n     * Handle response from extension\n     */\n    handleResponse(data) {\n        const pendingRequest = this.pendingRequests.get(data.messageId);\n        if (!pendingRequest)\n            return;\n        const { resolve, reject, timeoutId } = pendingRequest;\n        this.pendingRequests.delete(data.messageId);\n        clearTimeout(timeoutId);\n        if (data.success) {\n            resolve(data.payload);\n        }\n        else {\n            reject(data.error);\n        }\n    }\n    /**\n     * Handle event from extension\n     */\n    handleEvent(event) {\n        if (this.eventCallback) {\n            try {\n                this.eventCallback(event);\n            }\n            catch (error) {\n                // eslint-disable-next-line no-console\n                console.error('TonConnect event callback error:', error);\n            }\n        }\n    }\n    /**\n     * Send request to extension\n     */\n    async send(request) {\n        if (!this.isAvailable()) {\n            throw new Error('Chrome extension transport is not available');\n        }\n        return new Promise((resolve, reject) => {\n            const messageId = crypto.randomUUID();\n            const timeout = request.method === 'restoreConnection' ? RESTORE_CONNECTION_TIMEOUT : DEFAULT_REQUEST_TIMEOUT;\n            // Set timeout for request\n            const timeoutId = setTimeout(() => {\n                if (this.pendingRequests.has(messageId)) {\n                    this.pendingRequests.delete(messageId);\n                    reject(new Error(`Request timeout: ${request.method}`));\n                }\n            }, timeout);\n            // Store pending request\n            this.pendingRequests.set(messageId, { resolve, reject, timeoutId });\n            // Send message to extension\n            try {\n                // eslint-disable-next-line no-undef\n                chrome.runtime.sendMessage(this.extensionId, {\n                    type: TONCONNECT_BRIDGE_REQUEST,\n                    source: this.source,\n                    payload: request,\n                    messageId: messageId,\n                });\n            }\n            catch (error) {\n                this.pendingRequests.delete(messageId);\n                clearTimeout(timeoutId);\n                reject(error);\n            }\n        });\n    }\n    /**\n     * Register event callback\n     */\n    onEvent(callback) {\n        this.eventCallback = callback;\n    }\n    /**\n     * Check if transport is available\n     */\n    isAvailable() {\n        return typeof chrome !== 'undefined' && this.extensionId !== null;\n    }\n    /**\n     * Request content script injection for iframes\n     */\n    requestContentScriptInjection() {\n        if (!this.isAvailable())\n            return;\n        try {\n            // eslint-disable-next-line no-undef\n            chrome.runtime.sendMessage(this.extensionId, {\n                type: INJECT_CONTENT_SCRIPT,\n            });\n        }\n        catch (error) {\n            // eslint-disable-next-line no-console\n            console.error('Failed to request content script injection:', error);\n        }\n    }\n    /**\n     * Cleanup resources\n     */\n    destroy() {\n        // Clear all pending requests\n        this.pendingRequests.forEach(({ timeoutId }) => clearTimeout(timeoutId));\n        this.pendingRequests.clear();\n        // Remove message listener\n        if (this.messageListener) {\n            this.window.removeEventListener('message', this.messageListener);\n            this.messageListener = null;\n        }\n        this.eventCallback = null;\n        this.extensionId = null;\n    }\n}\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n/**\n * Watches for iframe creation in the DOM and triggers callbacks\n * Separated from bridge injection for better separation of concerns\n */\nexport class IframeWatcher {\n    onIframeDetected;\n    observer = null;\n    constructor(onIframeDetected) {\n        this.onIframeDetected = onIframeDetected;\n    }\n    /**\n     * Start watching for iframes\n     */\n    start() {\n        if (this.observer) {\n            return; // Already watching\n        }\n        this.observer = new MutationObserver((mutations) => {\n            this.handleMutations(mutations);\n        });\n        this.observer.observe(document.body, {\n            childList: true,\n            subtree: true,\n        });\n    }\n    /**\n     * Stop watching for iframes\n     */\n    stop() {\n        if (this.observer) {\n            this.observer.disconnect();\n            this.observer = null;\n        }\n    }\n    /**\n     * Handle DOM mutations\n     */\n    handleMutations(mutations) {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                this.handleAddedNode(node);\n            }\n        }\n    }\n    /**\n     * Handle a single added node\n     */\n    handleAddedNode(node) {\n        if (node.nodeType !== Node.ELEMENT_NODE) {\n            return;\n        }\n        const element = node;\n        // Check if this is an iframe\n        if (element.tagName === 'IFRAME') {\n            this.setupIframeListeners(element);\n            this.onIframeDetected();\n            return;\n        }\n        // Check if any child elements are iframes\n        const iframes = element.querySelectorAll('iframe');\n        if (iframes.length > 0) {\n            iframes.forEach((iframe) => {\n                this.setupIframeListeners(iframe);\n            });\n            this.onIframeDetected();\n        }\n    }\n    /**\n     * Setup event listeners for iframe\n     */\n    setupIframeListeners(iframe) {\n        const handleIframeEvent = () => {\n            this.onIframeDetected();\n        };\n        // Remove existing listeners to avoid duplicates\n        iframe.removeEventListener('load', handleIframeEvent);\n        iframe.removeEventListener('error', handleIframeEvent);\n        // Add listeners\n        iframe.addEventListener('load', handleIframeEvent);\n        iframe.addEventListener('error', handleIframeEvent);\n    }\n}\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n/**\n * Type-safe accessor for window object manipulation\n */\nexport class WindowAccessor {\n    window;\n    bridgeKey;\n    injectTonKey;\n    constructor(window, { bridgeKey, injectTonKey }) {\n        this.window = window;\n        this.bridgeKey = bridgeKey;\n        this.injectTonKey = injectTonKey ?? true;\n    }\n    /**\n     * Check if bridge already exists\n     */\n    exists() {\n        const windowObj = this.window;\n        return !!(windowObj[this.bridgeKey] && windowObj[this.bridgeKey].tonconnect);\n    }\n    /**\n     * Get bridge key name\n     */\n    getBridgeKey() {\n        return this.bridgeKey;\n    }\n    get tonKey() {\n        return 'ton';\n    }\n    /**\n     * Ensure wallet object exists on window\n     */\n    ensureWalletObject() {\n        const windowObj = this.window;\n        if (!windowObj[this.bridgeKey]) {\n            windowObj[this.bridgeKey] = {};\n        }\n        if (this.injectTonKey) {\n            if (!windowObj[this.tonKey]) {\n                windowObj[this.tonKey] = {};\n            }\n        }\n    }\n    /**\n     * Inject bridge into window object\n     */\n    injectBridge(bridge) {\n        this.ensureWalletObject();\n        const windowObj = this.window;\n        Object.defineProperty(windowObj[this.bridgeKey], 'tonconnect', {\n            value: bridge,\n            writable: false,\n            enumerable: true,\n            configurable: false,\n        });\n        if (this.injectTonKey) {\n            Object.defineProperty(windowObj[this.tonKey], 'tonconnect', {\n                value: bridge,\n                writable: false,\n                enumerable: true,\n                configurable: false,\n            });\n        }\n    }\n}\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport { getDeviceInfoWithDefaults, getWalletInfoWithDefaults } from '../../utils/getDefaultWalletConfig';\nimport { validateBridgeConfig } from '../core/BridgeConfig';\nimport { TonConnectBridge } from '../core/TonConnectBridge';\nimport { ExtensionTransport } from '../transport/ExtensionTransport';\nimport { SUPPORTED_PROTOCOL_VERSION } from '../utils/timeouts';\nimport { IframeWatcher } from './IframeWatcher';\nimport { WindowAccessor } from './WindowAccessor';\n/**\n * Cleanup function to remove bridge and stop watching\n */\n// export interface BridgeCleanup {\n//     cleanup: () => void;\n// }\n/**\n * Resolve jsBridgeKey from options\n */\nfunction resolveJsBridgeKey(options) {\n    // Direct jsBridgeKey takes precedence\n    if (options.jsBridgeKey) {\n        return options.jsBridgeKey;\n    }\n    // Try to extract from walletInfo\n    if (options.walletInfo) {\n        if ('jsBridgeKey' in options.walletInfo) {\n            return options.walletInfo.jsBridgeKey;\n        }\n        if ('name' in options.walletInfo) {\n            return options.walletInfo.name;\n        }\n    }\n    // Fallback\n    return 'unknown-wallet';\n}\n/**\n * Create bridge configuration from options\n */\nfunction createBridgeConfig(options) {\n    const deviceInfo = getDeviceInfoWithDefaults(options.deviceInfo);\n    const walletInfo = getWalletInfoWithDefaults(options.walletInfo);\n    const jsBridgeKey = resolveJsBridgeKey(options);\n    return {\n        deviceInfo,\n        walletInfo,\n        jsBridgeKey,\n        isWalletBrowser: options.isWalletBrowser ?? false,\n        protocolVersion: SUPPORTED_PROTOCOL_VERSION,\n    };\n}\n/**\n * Injects TonConnect JS Bridge into the window object\n * This is the main facade that orchestrates all components\n *\n * @param window - Window object to inject into\n * @param options - Configuration options\n * @returns Cleanup function to remove bridge and stop watching\n */\nexport function injectBridge(window, options, argsTransport) {\n    // 1. Create and validate configuration\n    const config = createBridgeConfig(options);\n    validateBridgeConfig(config);\n    let shouldInjectTonKey = undefined;\n    if (options.injectTonKey !== undefined) {\n        shouldInjectTonKey = options.injectTonKey;\n        // Redundant check, but keeping for clarity\n    }\n    else if (options.isWalletBrowser === true) {\n        shouldInjectTonKey = true;\n    }\n    else {\n        shouldInjectTonKey = true;\n    }\n    // 2. Create window accessor\n    const windowAccessor = new WindowAccessor(window, {\n        bridgeKey: config.jsBridgeKey,\n        injectTonKey: shouldInjectTonKey,\n    });\n    // 3. Check if bridge already exists\n    if (windowAccessor.exists()) {\n        // eslint-disable-next-line no-console\n        console.log(`${config.jsBridgeKey}.tonconnect already exists, skipping injection`);\n        return;\n    }\n    let transport;\n    if (argsTransport) {\n        transport = argsTransport;\n    }\n    else {\n        // const randomId = Math.random().toString(36).substring(2, 15);\n        const source = `${config.jsBridgeKey}-tonconnect`;\n        transport = new ExtensionTransport(window, source);\n    }\n    // 5. Create bridge instance\n    const bridge = new TonConnectBridge(config, transport);\n    // 6. Inject bridge into window\n    windowAccessor.injectBridge(bridge);\n    // eslint-disable-next-line no-console\n    console.log(`TonConnect JS Bridge injected for ${config.jsBridgeKey} - forwarding to extension`);\n    // 7. Setup iframe watcher\n    const iframeWatcher = new IframeWatcher(() => {\n        transport.requestContentScriptInjection();\n    });\n    iframeWatcher.start();\n    // 8. Return cleanup function\n    return;\n}\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport { injectBridge } from './injection/BridgeInjector';\nimport { TONCONNECT_BRIDGE_EVENT } from './utils/messageTypes';\nimport { DEFAULT_REQUEST_TIMEOUT, RESTORE_CONNECTION_TIMEOUT } from './utils/timeouts';\nexport { TONCONNECT_BRIDGE_EVENT, RESTORE_CONNECTION_TIMEOUT, DEFAULT_REQUEST_TIMEOUT, };\n/**\n * Injects a simplified TonConnect JS Bridge that forwards all requests to the parent extension\n * The extension handles all logic through WalletKit\n *\n * @param window - Window object to inject bridge into\n * @param options - Configuration options for the bridge\n */\nexport function injectBridgeCode(window, options, transport) {\n    injectBridge(window, options, transport);\n}\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n/**\n * Flexible logging utility for the Android WalletKit bridge.\n *\n * Logging can be controlled by setting the log level from the Android SDK:\n * window.__WALLETKIT_LOG_LEVEL__ = 'DEBUG'; // OFF, ERROR, WARN, INFO, DEBUG\n *\n * Default is 'OFF' in production for performance.\n */\n\n/**\n * Log levels in order of verbosity\n */\nexport enum LogLevel {\n    OFF = 0,\n    ERROR = 1,\n    WARN = 2,\n    INFO = 3,\n    DEBUG = 4,\n}\n\ntype LogLevelString = 'OFF' | 'ERROR' | 'WARN' | 'INFO' | 'DEBUG';\n\ntype LogWindow = Window & { __WALLETKIT_LOG_LEVEL__?: LogLevelString };\n\ntype ConsoleLike = {\n    log?: (...args: unknown[]) => void;\n    warn?: (...args: unknown[]) => void;\n    error?: (...args: unknown[]) => void;\n};\n\nconst logWindow = window as LogWindow;\nconst consoleRef = (globalThis as { console?: ConsoleLike }).console;\n\n/**\n * Get the current log level from window\n */\nfunction getCurrentLogLevel(): LogLevel {\n    const levelStr = logWindow.__WALLETKIT_LOG_LEVEL__ || 'OFF';\n    return LogLevel[levelStr] ?? LogLevel.OFF;\n}\n\n/**\n * Debug logger - logs detailed debugging information\n * Only logs when level is DEBUG or higher\n */\nexport const log = (...args: unknown[]): void => {\n    if (getCurrentLogLevel() >= LogLevel.DEBUG) {\n        consoleRef?.log?.('[WalletKit]', ...args);\n    }\n};\n\n/**\n * Info logger - logs informational messages\n * Only logs when level is INFO or higher\n */\nexport const info = (...args: unknown[]): void => {\n    if (getCurrentLogLevel() >= LogLevel.INFO) {\n        consoleRef?.log?.('[WalletKit]', ...args);\n    }\n};\n\n/**\n * Warning logger - logs warnings\n * Only logs when level is WARN or higher\n */\nexport const warn = (...args: unknown[]): void => {\n    if (getCurrentLogLevel() >= LogLevel.WARN) {\n        consoleRef?.warn?.('[WalletKit]', ...args);\n    }\n};\n\n/**\n * Error logger - logs errors\n * Only logs when level is ERROR or higher\n */\nexport const error = (...args: unknown[]): void => {\n    if (getCurrentLogLevel() >= LogLevel.ERROR) {\n        consoleRef?.error?.('[WalletKit]', ...args);\n    }\n};\n","/**\n * Copyright (c) TonTech.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// Bridge injection for Android internal browser\nimport { injectBridgeCode } from '@ton/walletkit/bridge';\nimport type { InjectedToExtensionBridgeRequestPayload, JSBridgeInjectOptions } from '@ton/walletkit';\nimport type { Transport } from '@ton/walletkit';\n\nimport { error } from './utils/logger';\n\ndeclare global {\n    interface Window {\n        injectWalletKit: (options: JSBridgeInjectOptions) => void;\n        AndroidTonConnect?: TonConnectBridge;\n    }\n}\n\ntype TonConnectBridge = {\n    __notifyResponse?: (messageId: string) => void;\n    __notifyEvent?: () => void;\n    pullResponse?: (messageId: string) => string | null;\n    pullEvent?: (frameId: string) => string | null;\n    hasEvent?: (frameId: string) => boolean;\n    postMessage?: (payload: string) => void;\n};\n\ntype TonConnectWindow = Window & {\n    __tonconnect_frameId?: string;\n    tonkeeper?: {\n        tonconnect?: {\n            isWalletBrowser?: boolean;\n        };\n    };\n};\n\nconst tonWindow = window as TonConnectWindow;\n\n// Generate unique frame ID\nconst frameId =\n    tonWindow.__tonconnect_frameId ||\n    (tonWindow.__tonconnect_frameId =\n        window === window.top ? 'main' : `frame-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`);\n\nconst isAndroidWebView = typeof tonWindow.AndroidTonConnect !== 'undefined';\n\n/**\n * Android WebView Transport Implementation\n * Uses BridgeInterface as message bus with postMessage for iframe communication\n */\nclass AndroidWebViewTransport implements Transport {\n    private pendingRequests = new Map<\n        string,\n        { resolve: (value: unknown) => void; reject: (error: Error) => void; timeout: ReturnType<typeof setTimeout> }\n    >();\n    private eventCallbacks: Array<(event: unknown) => void> = [];\n\n    constructor() {\n        // Set up notification handlers and postMessage relay\n        this.setupNotificationHandlers();\n        this.setupPostMessageRelay();\n    }\n\n    private setupNotificationHandlers(): void {\n        const bridge = tonWindow.AndroidTonConnect;\n        if (!bridge) return;\n\n        // Main frame: Pull from BridgeInterface and broadcast to iframes\n        if (window === window.top) {\n            bridge.__notifyResponse = (messageId: string) => {\n                this.handleResponseNotification(messageId);\n            };\n\n            bridge.__notifyEvent = () => {\n                this.handleEventNotification();\n            };\n        }\n    }\n\n    private setupPostMessageRelay(): void {\n        window.addEventListener('message', (event) => {\n            if (event.source === window) return;\n\n            if (event.data?.type === 'ANDROID_BRIDGE_RESPONSE') {\n                this.pullAndDeliverResponse(event.data.messageId);\n                document.querySelectorAll('iframe').forEach((iframe) => {\n                    try {\n                        iframe.contentWindow?.postMessage(event.data, '*');\n                    } catch (_e) {\n                        // Ignore cross-origin errors\n                    }\n                });\n            } else if (event.data?.type === 'ANDROID_BRIDGE_EVENT') {\n                this.pullAndDeliverEvent();\n                document.querySelectorAll('iframe').forEach((iframe) => {\n                    try {\n                        iframe.contentWindow?.postMessage(event.data, '*');\n                    } catch (_e) {\n                        // Ignore cross-origin errors\n                    }\n                });\n            }\n        });\n    }\n\n    private handleResponseNotification(messageId: string): void {\n        this.pullAndDeliverResponse(messageId);\n        document.querySelectorAll('iframe').forEach((iframe) => {\n            try {\n                iframe.contentWindow?.postMessage({ type: 'ANDROID_BRIDGE_RESPONSE', messageId }, '*');\n            } catch (_e) {\n                // Ignore cross-origin errors\n            }\n        });\n    }\n\n    private handleEventNotification(): void {\n        this.pullAndDeliverEvent();\n        document.querySelectorAll('iframe').forEach((iframe) => {\n            try {\n                iframe.contentWindow?.postMessage({ type: 'ANDROID_BRIDGE_EVENT' }, '*');\n            } catch (_e) {\n                // Ignore cross-origin errors\n            }\n        });\n    }\n\n    private pullAndDeliverResponse(messageId: string): void {\n        const pending = this.pendingRequests.get(messageId);\n        if (!pending) return;\n\n        try {\n            const bridge = tonWindow.AndroidTonConnect;\n            if (!bridge?.pullResponse) return;\n\n            const responseStr = bridge.pullResponse(messageId);\n            if (responseStr) {\n                const response = JSON.parse(responseStr);\n                clearTimeout(pending.timeout);\n                this.pendingRequests.delete(messageId);\n\n                if (response.error) {\n                    pending.reject(new Error(response.error.message || 'Failed'));\n                } else {\n                    pending.resolve(response.payload);\n                }\n            }\n        } catch (err) {\n            error('[AndroidTransport] Failed to pull/process response:', err);\n            pending.reject(err as Error);\n        }\n    }\n\n    private pullAndDeliverEvent(): void {\n        try {\n            const bridge = tonWindow.AndroidTonConnect;\n            if (!bridge?.pullEvent || !bridge?.hasEvent) return;\n\n            while (bridge.hasEvent(frameId)) {\n                const eventStr = bridge.pullEvent(frameId);\n                if (eventStr) {\n                    const data = JSON.parse(eventStr) as { type?: string; event?: unknown };\n                    if (data.type === 'TONCONNECT_BRIDGE_EVENT' && data.event) {\n                        this.eventCallbacks.forEach((callback) => {\n                            try {\n                                callback(data.event);\n                            } catch (err) {\n                                error('[AndroidTransport] Event callback error:', err);\n                            }\n                        });\n                    }\n                }\n            }\n        } catch (err) {\n            error('[AndroidTransport] Failed to pull/process event:', err);\n        }\n    }\n\n    async send(request: Omit<InjectedToExtensionBridgeRequestPayload, 'id'>): Promise<unknown> {\n        const messageId = `msg-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n        const bridge = tonWindow.AndroidTonConnect;\n        if (!bridge?.postMessage) {\n            throw new Error('AndroidTonConnect postMessage is not available');\n        }\n\n        bridge.postMessage(\n            JSON.stringify({\n                type: 'TONCONNECT_BRIDGE_REQUEST',\n                messageId,\n                method: request.method || 'unknown',\n                params: request.params || {},\n                frameId,\n            }),\n        );\n\n        return new Promise((resolve, reject) => {\n            const timeout = setTimeout(() => {\n                this.pendingRequests.delete(messageId);\n                reject(new Error('Request timeout'));\n            }, 30000);\n\n            this.pendingRequests.set(messageId, { resolve, reject, timeout });\n        });\n    }\n\n    onEvent(callback: (event: unknown) => void): void {\n        this.eventCallbacks.push(callback);\n    }\n\n    isAvailable(): boolean {\n        return isAndroidWebView;\n    }\n\n    requestContentScriptInjection(): void {\n        const iframes = document.querySelectorAll('iframe');\n        iframes.forEach((iframe) => {\n            try {\n                const iframeWindowRaw = iframe.contentWindow;\n                if (!iframeWindowRaw) {\n                    return;\n                }\n\n                if (iframeWindowRaw === window) {\n                    return;\n                }\n\n                // Check if bridge already exists in this iframe\n                const iframeWindow = iframeWindowRaw as TonConnectWindow;\n                const hasExtension = !!iframeWindow.tonkeeper?.tonconnect;\n\n                if (!hasExtension) {\n                    // Re-inject with the same options that were passed to the parent window\n                    const mainWindow = window as TonConnectWindow & { __walletKitOptions?: JSBridgeInjectOptions };\n                    if (iframeWindow.injectWalletKit && mainWindow.__walletKitOptions) {\n                        iframeWindow.injectWalletKit(mainWindow.__walletKitOptions);\n                    }\n                }\n            } catch (_e) {\n                // Cross-origin iframe - will use postMessage bridge\n            }\n        });\n    }\n\n    destroy(): void {\n        this.pendingRequests.forEach(({ timeout, reject }) => {\n            clearTimeout(timeout);\n            reject(new Error('Transport destroyed'));\n        });\n        this.pendingRequests.clear();\n        this.eventCallbacks = [];\n\n        const bridge = tonWindow.AndroidTonConnect;\n        if (bridge) {\n            delete bridge.__notifyResponse;\n            delete bridge.__notifyEvent;\n        }\n    }\n}\n\n/**\n * Injection function called by Android with config from WalletKit\n * Matches iOS pattern: window.injectWalletKit(options)\n */\nwindow.injectWalletKit = (options: JSBridgeInjectOptions) => {\n    try {\n        // Store options for iframe injection\n        (window as TonConnectWindow & { __walletKitOptions?: JSBridgeInjectOptions }).__walletKitOptions = options;\n\n        // Create custom transport for Android or undefined for default behavior\n        const transport: Transport | undefined = isAndroidWebView ? new AndroidWebViewTransport() : undefined;\n\n        // Inject wallet with configuration from Android SDK\n        injectBridgeCode(window, options, transport);\n    } catch (_error) {\n        // Silent fail - errors logged internally\n    }\n};\n"],"names":["error","window","LogLevel","_a"],"mappings":"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"}